<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PODIUM PREMIUM</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .premium-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; }
        .btn-gold { background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); color: #000; font-weight: 900; }
        .podium-slot { border: 2px dashed #475569; border-radius: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none; }
    </style>
</head>
<body class="p-4">

    <div id="view-login" class="max-w-md mx-auto mt-20 text-center">
        <h1 class="text-3xl font-black mb-8">PÓDIUM <span class="text-amber-500">PREMIUM</span></h1>
        <div class="premium-card p-8 shadow-2xl">
            <input id="login-user" type="text" placeholder="USUARIO" class="w-full p-4 mb-4 rounded-xl bg-slate-900 border border-slate-700 focus:outline-none focus:border-amber-500 uppercase">
            <input id="login-pass" type="password" placeholder="CONTRASEÑA" class="w-full p-4 mb-6 rounded-xl bg-slate-900 border border-slate-700 focus:outline-none focus:border-amber-500">
            <button onclick="handleLogin()" class="w-full btn-gold py-4 rounded-xl shadow-lg hover:scale-105 transition-transform">INICIAR SESIÓN</button>
        </div>
    </div>

    <div id="view-region" class="hidden max-w-md mx-auto pt-10">
        <h2 class="text-2xl font-black mb-6 uppercase text-center">SELECCIONA TU REGIÓN</h2>
        <div id="region-list" class="grid gap-4">
            </div>
    </div>

    <div id="view-dashboard" class="hidden max-w-md mx-auto pt-6">
        <div class="premium-card p-6 mb-8 text-center border-amber-500/30">
            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">MONTO ESTIMADO</p>
            <h3 id="dash-pozo" class="text-4xl font-black text-amber-500">$0</h3>
            <p id="dash-participantes" class="text-sm mt-2 font-bold uppercase tracking-tighter">PARTICIPANTES: 0</p>
        </div>

        <div class="grid gap-6">
            <button onclick="selectNivel('Básico')" class="premium-card p-6 flex justify-between items-center group">
                <div>
                    <h4 class="text-xl font-black uppercase">NIVEL BÁSICO</h4>
                    <p class="text-xs text-slate-400 uppercase">PARTICIPAR AHORA</p>
                </div>
                <div class="text-amber-500">→</div>
            </button>
            <button onclick="selectNivel('Medio')" class="premium-card p-6 flex justify-between items-center group">
                <div>
                    <h4 class="text-xl font-black uppercase">NIVEL MEDIO</h4>
                    <p class="text-xs text-slate-400 uppercase">PARTICIPAR AHORA</p>
                </div>
                <div class="text-amber-500">→</div>
            </button>
            <button onclick="selectNivel('Alto')" class="premium-card p-6 flex justify-between items-center group">
                <div>
                    <h4 class="text-xl font-black uppercase">NIVEL ALTO</h4>
                    <p class="text-xs text-slate-400 uppercase">PARTICIPAR AHORA</p>
                </div>
                <div class="text-amber-500">→</div>
            </button>
        </div>
    </div>

    <div id="view-podium" class="hidden max-w-md mx-auto pt-6">
        <div class="flex justify-between items-center mb-6">
            <button onclick="showView('view-dashboard')" class="text-xs font-bold uppercase text-slate-400">← VOLVER</button>
            <h2 id="podium-title" class="text-xl font-black uppercase">TU PÓDIUM</h2>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div id="slot-1" class="podium-slot text-center flex-col p-2 bg-slate-800/50">
                <span class="text-[10px] font-bold text-amber-500 block">1° LUGAR</span>
                <span id="txt-p1" class="text-xs font-black uppercase">VACÍO</span>
            </div>
            <div id="slot-2" class="podium-slot text-center flex-col p-2">
                <span class="text-[10px] font-bold text-slate-400 block">2° LUGAR</span>
                <span id="txt-p2" class="text-xs font-black uppercase">VACÍO</span>
            </div>
            <div id="slot-3" class="podium-slot text-center flex-col p-2">
                <span class="text-[10px] font-bold text-slate-400 block">3° LUGAR</span>
                <span id="txt-p3" class="text-xs font-black uppercase">VACÍO</span>
            </div>
        </div>

        <div id="band-list" class="grid grid-cols-2 gap-3 mb-24">
            </div>

        <div class="fixed bottom-0 left-0 w-full p-6 bg-slate-900/90 backdrop-blur-md">
            <button onclick="confirmarApuesta()" class="w-full btn-gold py-4 rounded-xl shadow-lg uppercase tracking-widest">CONFIRMAR APUESTA</button>
        </div>
    </div>

    <div id="modal-confirm" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-6 z-50">
        <div class="premium-card p-8 w-full max-w-sm text-center">
            <h3 class="text-xl font-black mb-4 uppercase">¿CONFIRMAR ACCIÓN?</h3>
            <p id="modal-msg" class="text-sm text-slate-400 mb-8 uppercase tracking-tighter">ESTA ACCIÓN NO SE PUEDE DESHACER SI HAS SUPERADO EL LÍMITE DE EDICIONES.</p>
            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-3 font-bold text-slate-400 uppercase">CANCELAR</button>
                <button id="btn-modal-action" class="flex-1 btn-gold py-3 rounded-lg uppercase">SÍ, CONTINUAR</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx62SOGYP4qeQHhN3h5lMNxKODdMIgL7xTELRD-5r0yqrllqtnZBFgcDKd82CL7fRcU/exec';
        let currentUser = localStorage.getItem('podium_user') || null;
        let appData = { region: '', nivel: '', p1: null, p2: null, p3: null };
        let allBandas = [];

        // INICIALIZACIÓN
        if (currentUser) { 
            showView('view-region');
            loadData();
        }

        function showView(id) {
            document.querySelectorAll('div[id^="view-"]').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        async function handleLogin() {
            const user = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            if (!user || !pass) return;

            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'login', user, pass })
            });
            const data = await res.json();

            if (data.success) {
                currentUser = user;
                localStorage.setItem('podium_user', user);
                showView('view-region');
                loadData();
            } else {
                alert('CREDENCIALES INCORRECTAS');
            }
        }

        async function loadData() {
            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'getData', user: currentUser })
            });
            const data = await res.json();
            
            document.getElementById('dash-pozo').innerText = '$' + data.config.base_pozo.toLocaleString();
            document.getElementById('dash-participantes').innerText = 'PARTICIPANTES: ' + data.config.participantes;
            allBandas = data.bandas;

            // Renderizar Regiones
            const regiones = ['NORTE', 'CENTRO-SUR', 'ORIENTE', 'MAGDALENA CALDENSE', 'OCCIDENTE PROSPERO', 'ALTO OCCIDENTE'];
            const container = document.getElementById('region-list');
            container.innerHTML = '';
            regiones.forEach(r => {
                const btn = document.createElement('button');
                btn.className = 'premium-card p-5 font-bold uppercase tracking-widest hover:border-amber-500 transition-colors';
                btn.innerText = r;
                btn.onclick = () => { appData.region = r; showView('view-dashboard'); };
                container.appendChild(btn);
            });
        }

        function selectNivel(nivel) {
            appData.nivel = nivel;
            appData.p1 = null; appData.p2 = null; appData.p3 = null;
            document.getElementById('podium-title').innerText = nivel;
            renderBandas();
            updatePodiumUI();
            showView('view-podium');
        }

        function renderBandas() {
            const container = document.getElementById('band-list');
            container.innerHTML = '';
            const filtradas = allBandas.filter(b => b.region.toUpperCase() === appData.region && b.nivel === appData.nivel);
            
            filtradas.forEach(b => {
                const btn = document.createElement('button');
                btn.className = 'premium-card p-4 text-[10px] font-bold uppercase leading-tight';
                btn.innerText = b.nombre;
                btn.onclick = () => addToPodium(b.nombre);
                container.appendChild(btn);
            });
        }

        function addToPodium(nombre) {
            if (!appData.p1) appData.p1 = nombre;
            else if (!appData.p2) appData.p2 = nombre;
            else if (!appData.p3) appData.p3 = nombre;
            updatePodiumUI();
        }

        function updatePodiumUI() {
            document.getElementById('txt-p1').innerText = appData.p1 || 'VACÍO';
            document.getElementById('txt-p2').innerText = appData.p2 || 'VACÍO';
            document.getElementById('txt-p3').innerText = appData.p3 || 'VACÍO';
        }

        function closeModal() { document.getElementById('modal-confirm').classList.add('hidden'); }

        function confirmarApuesta() {
            if (!appData.p1 || !appData.p2 || !appData.p3) return alert('COMPLETA EL PÓDIUM');
            document.getElementById('modal-confirm').classList.remove('hidden');
            document.getElementById('btn-modal-action').onclick = sendApuesta;
        }

        async function sendApuesta() {
            closeModal();
            const payload = {
                action: 'saveApuesta',
                user: currentUser,
                region: appData.region,
                categoria: appData.nivel,
                p1: appData.p1, p2: appData.p2, p3: appData.p3,
                monto: 0 // Aquí podrías jalar el costo_entrada de config
            };

            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
            alert('¡APUESTA REGISTRADA CON ÉXITO!');
            showView('view-dashboard');
            loadData();
        }
    </script>
</body>
</html>
